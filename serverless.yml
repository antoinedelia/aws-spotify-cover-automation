service: spotify-cover-automation

provider:
  name: aws
  stage: prod
  runtime: python3.9
  region: eu-west-1
  iam:
    role:
      statements:
      - Effect: 'Allow'
        Action: '*'
        Resource: '*'

package:
  patterns:
    - "!node_modules/**"
    - "!serverless_deployment/**"
    - "!assets/**"
    - "!tests/**"

custom:
  s3Sync:
    - bucketName: antoinedelia
      localDir: web

functions:
  cover_automation:
    handler: src/main.lambda_handler
    name: spotify-cover-automation
    timeout: 29
    maximumRetryAttempts: 1
    events:
      - http:
          path: /spotify/cover-automation
          method: post
          cors:
            headers:
              - '*'
  get_playlists:
    handler: src/handlers/get_playlists.lambda_handler
    name: ${sls:service}-${sls:stage}-get_playlists
    timeout: 29
    maximumRetryAttempts: 1
    events:
      - http:
          path: /spotify-cover-automation/playlists
          method: get
          cors:
            headers:
              - '*'

plugins:
  - serverless-python-requirements
  - serverless-s3-sync
